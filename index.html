import { useState } from "react";
import { Card, CardContent } from "@/components/ui/card";
import { Button } from "@/components/ui/button";

const questions = [
  { id: 1, text: "我是聚会中的活跃分子。", dimension: "extraversion" },
  { id: 2, text: "我很少关心他人。", dimension: "agreeableness" },
  { id: 3, text: "我总是做好准备。", dimension: "conscientiousness" },
  { id: 4, text: "我很容易紧张。", dimension: "neuroticism" },
  { id: 5, text: "我词汇丰富。", dimension: "openness" },
  { id: 6, text: "我不太爱说话。", dimension: "extraversion", reverse: true },
  { id: 7, text: "我对他人感兴趣。", dimension: "agreeableness" },
  { id: 8, text: "我常常把东西乱丢。", dimension: "conscientiousness", reverse: true },
  { id: 9, text: "我大多数时候都很放松。", dimension: "neuroticism", reverse: true },
  { id: 10, text: "我难以理解抽象的想法。", dimension: "openness", reverse: true },
  { id: 11, text: "我在人群中感到自在。", dimension: "extraversion" },
  { id: 12, text: "我会侮辱他人。", dimension: "agreeableness", reverse: true },
  { id: 13, text: "我注重细节。", dimension: "conscientiousness" },
  { id: 14, text: "我常常担心事情。", dimension: "neuroticism" },
  { id: 15, text: "我有丰富的想象力。", dimension: "openness" },
  { id: 16, text: "我倾向于默默待在角落。", dimension: "extraversion", reverse: true },
  { id: 17, text: "我能同情他人的感受。", dimension: "agreeableness" },
  { id: 18, text: "我把事情搞得一团糟。", dimension: "conscientiousness", reverse: true },
  { id: 19, text: "我很少情绪低落。", dimension: "neuroticism", reverse: true },
  { id: 20, text: "我对抽象概念不感兴趣。", dimension: "openness", reverse: true },
  { id: 21, text: "我主动发起对话。", dimension: "extraversion" },
  { id: 22, text: "我对别人的问题不感兴趣。", dimension: "agreeableness", reverse: true },
  { id: 23, text: "我会立刻完成家务。", dimension: "conscientiousness" },
  { id: 24, text: "我很容易被打扰。", dimension: "neuroticism" },
  { id: 25, text: "我有很棒的点子。", dimension: "openness" },
  { id: 26, text: "我话不多。", dimension: "extraversion", reverse: true },
  { id: 27, text: "我心地善良。", dimension: "agreeableness" },
  { id: 28, text: "我经常忘了把东西放回原处。", dimension: "conscientiousness", reverse: true },
  { id: 29, text: "我很容易烦躁。", dimension: "neuroticism" },
  { id: 30, text: "我缺乏想象力。", dimension: "openness", reverse: true },
  { id: 31, text: "我喜欢在聚会中与各种人交谈。", dimension: "extraversion" },
  { id: 32, text: "我对他人不感兴趣。", dimension: "agreeableness", reverse: true },
  { id: 33, text: "我喜欢有条理。", dimension: "conscientiousness" },
  { id: 34, text: "我的情绪变化很大。", dimension: "neuroticism" },
  { id: 35, text: "我理解力强。", dimension: "openness" },
  { id: 36, text: "我不喜欢引人注目。", dimension: "extraversion", reverse: true },
  { id: 37, text: "我愿意为他人付出时间。", dimension: "agreeableness" },
  { id: 38, text: "我逃避责任。", dimension: "conscientiousness", reverse: true },
  { id: 39, text: "我的情绪经常波动。", dimension: "neuroticism" },
  { id: 40, text: "我喜欢使用复杂的词语。", dimension: "openness" },
  { id: 41, text: "我不介意成为注意焦点。", dimension: "extraversion" },
  { id: 42, text: "我能感受到他人的情绪。", dimension: "agreeableness" },
  { id: 43, text: "我会遵循日程安排。", dimension: "conscientiousness" },
  { id: 44, text: "我很容易被激怒。", dimension: "neuroticism" },
  { id: 45, text: "我喜欢反思事情。", dimension: "openness" },
  { id: 46, text: "我在陌生人面前很安静。", dimension: "extraversion", reverse: true },
  { id: 47, text: "我让人感到轻松自在。", dimension: "agreeableness" },
  { id: 48, text: "我对工作要求严格。", dimension: "conscientiousness" },
  { id: 49, text: "我经常情绪低落。", dimension: "neuroticism" },
  { id: 50, text: "我有很多主意。", dimension: "openness" }
];

const scale = [
  { value: 1, label: "非常不同意" },
  { value: 2, label: "不同意" },
  { value: 3, label: "中立" },
  { value: 4, label: "同意" },
  { value: 5, label: "非常同意" }
];

export default function PersonalityTest() {
  const [answers, setAnswers] = useState({});
  const [submitted, setSubmitted] = useState(false);

  const handleSelect = (questionId, value) => {
    setAnswers((prev) => ({ ...prev, [questionId]: value }));
  };

  const handleSubmit = () => {
    setSubmitted(true);
  };

  const getResults = () => {
    const results = {};
    questions.forEach(({ id, dimension, reverse }) => {
      if (!results[dimension]) results[dimension] = [];
      let score = answers[id] || 0;
      if (reverse) score = 6 - score;
      results[dimension].push(score);
    });
    const scores = {};
    for (const dim in results) {
      const vals = results[dim];
      scores[dim] = (vals.reduce((a, b) => a + b, 0) / vals.length).toFixed(2);
    }
    return scores;
  };

  return (
    <div className="max-w-2xl mx-auto p-6 space-y-6">
      <h1 className="text-2xl font-bold">IPIP大五人格测试（中文版）</h1>
      {!submitted ? (
        <form className="space-y-4">
          {questions.map((q) => (
            <Card key={q.id}>
              <CardContent className="p-4">
                <p className="font-medium mb-2">{q.text}</p>
                <div className="flex gap-2 flex-wrap">
                  {scale.map((opt) => (
                    <Button
                      key={opt.value}
                      variant={answers[q.id] === opt.value ? "default" : "outline"}
                      onClick={(e) => {
                        e.preventDefault();
                        handleSelect(q.id, opt.value);
                      }}
                    >
                      {opt.label}
                    </Button>
                  ))}
                </div>
              </CardContent>
            </Card>
          ))}
          <Button type="submit" onClick={(e) => { e.preventDefault(); handleSubmit(); }}>
            提交答案
          </Button>
        </form>
      ) : (
        <div>
          <h2 className="text-xl font-semibold mb-4">你的大五人格得分：</h2>
          <ul className="space-y-2">
            {Object.entries(getResults()).map(([dim, score]) => (
              <li key={dim}>
                <strong>{dim}</strong>：{score} / 5
              </li>
            ))}
          </ul>
        </div>
      )}
    </div>
  );
}
